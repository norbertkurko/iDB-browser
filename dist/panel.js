import{c as $,j as e,R as n}from"./assets/client-COpmvNre.js";const V=()=>{const[b,M]=n.useState([]),[s,_]=n.useState(""),[T,A]=n.useState([]),[a,D]=n.useState(""),[y,v]=n.useState([]),[h,C]=n.useState(null),[l,f]=n.useState(!1),[p,k]=n.useState(""),[m,R]=n.useState(0),[d,G]=n.useState(0),[P,g]=n.useState(""),u=20,z=async t=>{try{const[r]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!r.id)throw new Error("No active tab");console.log("Panel sending message:",t);const o=await chrome.tabs.sendMessage(r.id,t);if(console.log("Panel received response:",o),!o)throw new Error("No response received");if(!o.success)throw new Error(o.error||"Unknown error");return o}catch(r){throw console.error("Panel message error:",r),r}},L=async()=>{f(!0),g("");try{const r=((await z({action:"GET_DATABASES"})).data||[]).map(o=>({name:o.name||"Unknown",version:o.version||1,stores:Array.isArray(o.stores)?o.stores:[],storeCount:Array.isArray(o.stores)?o.stores.length:0}));M(r)}catch(t){console.error("Error loading databases:",t),g("Failed to load databases. Make sure to refresh the page first.")}finally{f(!1)}},N=async t=>{f(!0),g("");try{console.log("Loading stores for database:",t);const o=((await z({action:"GET_DATABASE_STORES",dbName:t})).data||[]).map(i=>({name:i.name||"Unknown",keyPath:i.keyPath,autoIncrement:i.autoIncrement||!1,indexes:i.indexes||[],recordCount:typeof i.recordCount=="number"?i.recordCount:0}));A(o)}catch(r){console.error("Error loading stores:",r),g("Failed to load tables for database: "+t),A([])}finally{f(!1)}},j=async(t,r,o=0,i="")=>{f(!0),g("");try{console.log("Loading table data:",t,r,{page:o,search:i});const x=await z({action:"GET_TABLE_DATA",dbName:t,storeName:r,options:{limit:u,offset:o*u,search:i.trim()||void 0}});console.log("Table data loaded:",x.data),v(x.data.data||[]),C(x.data.schema||null),R(x.data.totalCount||0),G(o)}catch(x){console.error("Error loading table data:",x),g("Failed to load data from table: "+r),v([]),C(null),R(0)}finally{f(!1)}},I=n.useCallback(n.useMemo(()=>{let t;return r=>{clearTimeout(t),t=setTimeout(()=>{s&&a&&j(s,a,0,r)},300)}},[s,a]),[s,a]);n.useEffect(()=>{L()},[]),n.useEffect(()=>{s&&(N(s),D(""),v([]),C(null),k(""))},[s]),n.useEffect(()=>{s&&a&&j(s,a,0,p)},[s,a]),n.useEffect(()=>{I(p)},[p,I]);const W=t=>{if(t.length===0)return[];const r=new Set;t.forEach(c=>{c&&typeof c=="object"&&Object.keys(c).forEach(w=>{typeof c[w]!="object"||c[w],r.add(w)})});const o=Array.from(r),i=["id","name","title","type","status","created","updated"],x=o.filter(c=>i.includes(c.toLowerCase())),U=o.filter(c=>!i.includes(c.toLowerCase()));return[...x,...U].slice(0,8)},O=(t,r)=>{if(t==null)return e.jsx("span",{style:{color:"#999",fontStyle:"italic"},children:"null"});if(typeof t=="boolean")return e.jsx("span",{style:{color:t?"#28a745":"#dc3545"},children:t?"✓ true":"✗ false"});if(typeof t=="number"){if(r.toLowerCase().includes("time")||r.toLowerCase().includes("date")){if(t>1e12)return new Date(t).toLocaleString();if(t>1e9)return new Date(t*1e3).toLocaleString()}return t.toLocaleString()}if(typeof t=="object"){const i=JSON.stringify(t).substring(0,100);return e.jsxs("span",{style:{cursor:"pointer",color:"#007bff",textDecoration:"underline"},title:"Click to expand",children:[i,i.length>=100?"...":""]})}const o=String(t);return o.length>100?e.jsxs("span",{title:o,children:[o.substring(0,100),"..."]}):o},S=Math.ceil(m/u),E=d<S-1,B=d>0;return e.jsxs("div",{style:{fontFamily:"system-ui, sans-serif",height:"100vh",width:"100vw",display:"flex",backgroundColor:"#f8f9fa",position:"fixed",top:0,left:0,zIndex:999999,overflow:"hidden"},children:[e.jsxs("div",{style:{width:"320px",borderRight:"1px solid #dee2e6",padding:"20px",backgroundColor:"white",overflowY:"auto",boxShadow:"2px 0 5px rgba(0,0,0,0.1)"},children:[e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h2",{style:{margin:"0 0 16px 0",fontSize:"20px",color:"#343a40"},children:"🗄️ IndexedDB Explorer"}),e.jsx("button",{onClick:L,disabled:l,style:{padding:"8px 16px",fontSize:"14px",border:"1px solid #dee2e6",borderRadius:"6px",cursor:l?"not-allowed":"pointer",backgroundColor:l?"#f8f9fa":"#007bff",color:l?"#6c757d":"white",marginBottom:"20px"},children:l?"🔄 Loading...":"🔄 Refresh"})]}),P&&e.jsxs("div",{style:{padding:"12px",backgroundColor:"#f8d7da",color:"#721c24",fontSize:"12px",borderRadius:"4px",marginBottom:"16px",border:"1px solid #f5c6cb"},children:["⚠️ ",P]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",marginBottom:"8px",color:"#495057"},children:"Database:"}),e.jsxs("select",{value:s,onChange:t=>_(t.target.value),style:{width:"100%",padding:"8px 12px",fontSize:"14px",border:"1px solid #ced4da",borderRadius:"4px",backgroundColor:"white"},children:[e.jsx("option",{value:"",children:"Select database..."}),b.map(t=>e.jsxs("option",{value:t.name,children:[t.name," (v",t.version,", ",t.storeCount," tables)"]},t.name))]})]}),s&&T.length>0&&e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",marginBottom:"8px",color:"#495057"},children:"Table:"}),e.jsxs("select",{value:a,onChange:t=>D(t.target.value),style:{width:"100%",padding:"8px 12px",fontSize:"14px",border:"1px solid #ced4da",borderRadius:"4px",backgroundColor:"white"},children:[e.jsx("option",{value:"",children:"Select table..."}),T.map(t=>e.jsxs("option",{value:t.name,children:[t.name," (",t.recordCount," records)"]},t.name))]})]}),h&&e.jsxs("div",{style:{padding:"16px",backgroundColor:"#f8f9fa",borderRadius:"6px",border:"1px solid #e9ecef"},children:[e.jsx("h4",{style:{margin:"0 0 12px 0",fontSize:"14px",color:"#495057"},children:"Table Schema"}),e.jsxs("div",{style:{fontSize:"12px",color:"#6c757d"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Key:"})," ",h.keyPath?String(h.keyPath):"None"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Auto Increment:"})," ",h.autoIncrement?"Yes":"No"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Indexes:"})," ",h.indexes.length]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Records:"})," ",h.recordCount.toLocaleString()]})]})]})]}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",minWidth:0},children:[e.jsx("div",{style:{padding:"20px",backgroundColor:"white",borderBottom:"1px solid #dee2e6",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{margin:"0 0 4px 0",fontSize:"24px",color:"#343a40"},children:a?`${a}`:"Select a table"}),s&&a&&e.jsxs("p",{style:{margin:0,color:"#6c757d",fontSize:"14px"},children:[s," → ",m.toLocaleString()," records",d>0&&e.jsxs("span",{children:[" → Page ",d+1," of ",S]})]})]}),a&&e.jsx("div",{style:{display:"flex",gap:"12px",alignItems:"center"},children:e.jsx("input",{type:"text",placeholder:"Search in table...",value:p,onChange:t=>k(t.target.value),style:{padding:"8px 12px",fontSize:"14px",border:"1px solid #ced4da",borderRadius:"4px",width:"250px"}})})]})}),e.jsx("div",{style:{flex:1,padding:"20px",overflow:"auto"},children:l?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"#6c757d"},children:e.jsx("div",{children:"🔄 Loading data..."})}):s&&a&&y?e.jsx("div",{children:y.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{backgroundColor:"white",borderRadius:"8px",border:"1px solid #dee2e6",overflow:"hidden",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"14px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f8f9fa"},children:[e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",borderBottom:"2px solid #dee2e6",fontWeight:"600",color:"#495057",width:"40px"},children:"#"}),W(y).map(t=>e.jsx("th",{style:{padding:"12px 16px",textAlign:"left",borderBottom:"2px solid #dee2e6",fontWeight:"600",color:"#495057"},children:t},t))]})}),e.jsx("tbody",{children:y.map((t,r)=>e.jsxs("tr",{style:{borderBottom:"1px solid #f1f3f4",backgroundColor:r%2===0?"white":"#fafbfc"},children:[e.jsx("td",{style:{padding:"12px 16px",color:"#6c757d",fontSize:"12px"},children:d*u+r+1}),W(y).map(o=>e.jsx("td",{style:{padding:"12px 16px",maxWidth:"200px",overflow:"hidden",verticalAlign:"top"},children:O(t[o],o)},o))]},r))})]})}),S>1&&e.jsxs("div",{style:{marginTop:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{fontSize:"14px",color:"#6c757d"},children:["Showing ",d*u+1," to ",Math.min((d+1)*u,m)," of ",m.toLocaleString()," records"]}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("button",{onClick:()=>j(s,a,d-1,p),disabled:!B||l,style:{padding:"8px 16px",fontSize:"14px",border:"1px solid #dee2e6",borderRadius:"4px",cursor:!B||l?"not-allowed":"pointer",backgroundColor:!B||l?"#f8f9fa":"white"},children:"← Previous"}),e.jsxs("span",{style:{padding:"8px 16px",fontSize:"14px",color:"#6c757d"},children:["Page ",d+1," of ",S]}),e.jsx("button",{onClick:()=>j(s,a,d+1,p),disabled:!E||l,style:{padding:"8px 16px",fontSize:"14px",border:"1px solid #dee2e6",borderRadius:"4px",cursor:!E||l?"not-allowed":"pointer",backgroundColor:!E||l?"#f8f9fa":"white"},children:"Next →"})]})]})]}):e.jsxs("div",{style:{textAlign:"center",padding:"60px 20px",color:"#6c757d"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"📭"}),e.jsx("h3",{style:{margin:"0 0 8px 0"},children:"No data found"}),e.jsx("p",{children:"This table appears to be empty or no records match your search."}),p&&e.jsx("button",{onClick:()=>k(""),style:{marginTop:"12px",padding:"8px 16px",fontSize:"14px",border:"1px solid #007bff",borderRadius:"4px",backgroundColor:"#007bff",color:"white",cursor:"pointer"},children:"Clear search"})]})}):e.jsxs("div",{style:{textAlign:"center",padding:"80px 20px",color:"#6c757d"},children:[e.jsx("div",{style:{fontSize:"64px",marginBottom:"20px"},children:"🗄️"}),e.jsx("h3",{style:{margin:"0 0 12px 0",fontSize:"24px"},children:"Welcome to IndexedDB Explorer!"}),e.jsx("p",{style:{fontSize:"16px",marginBottom:"8px"},children:"Select a database and table from the sidebar to view data."}),e.jsx("p",{style:{fontSize:"14px"},children:b.length===0?"No IndexedDB databases found on this page.":`Found ${b.length} database${b.length!==1?"s":""} on this page.`})]})})]})]})},F=document.getElementById("root");F&&$(F).render(e.jsx(V,{}));
