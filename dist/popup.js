import{c as C,j as e,R as r}from"./assets/client-COpmvNre.js";const z=()=>{const[i,j]=r.useState([]),[D,k]=r.useState(""),[l,c]=r.useState([]),[d,f]=r.useState(!1),[s,g]=r.useState(""),[h,a]=r.useState(""),y=async t=>{try{const[o]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!o.id)throw new Error("No active tab found");console.log("Sending message:",t);const n=await chrome.tabs.sendMessage(o.id,t);return console.log("Received response:",n),n}catch(o){throw console.error("Message sending failed:",o),o}},x=async()=>{f(!0),a("");try{const t=await y({action:"GET_DATABASES"});if(t&&t.success){console.log("Databases loaded:",t.data);const o=(t.data||[]).map(n=>({name:n.name||"Unknown",version:n.version||1,stores:Array.isArray(n.stores)?n.stores:[],storeCount:Array.isArray(n.stores)?n.stores.length:0}));j(o)}else console.error("Invalid response:",t),a((t==null?void 0:t.error)||"Failed to load databases")}catch(t){console.error("Failed to load databases:",t),a("Failed to communicate with content script. Try refreshing the page.")}finally{f(!1)}},v=async t=>{a("");try{console.log("Loading stores for database:",t);const o=await y({action:"GET_DATABASE_STORES",dbName:t});if(o&&o.success){console.log("Stores loaded:",o.data);const n=(o.data||[]).map(p=>({name:p.name||"Unknown",recordCount:typeof p.recordCount=="number"?p.recordCount:0}));c(n)}else console.error("Failed to load stores:",o),c([]),a((o==null?void 0:o.error)||"Failed to load tables")}catch(o){console.error("Failed to load stores:",o),c([]),a("Failed to load table information")}},S=async t=>{s===t?(g(""),c([])):(g(t),await v(t))},w=()=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{t[0].id&&chrome.scripting.executeScript({target:{tabId:t[0].id},func:()=>{const o=document.createElement("div");o.style.cssText=`
              position: fixed;
              top: 20px;
              right: 20px;
              background: #007bff;
              color: white;
              padding: 12px 20px;
              border-radius: 8px;
              font-family: system-ui, sans-serif;
              font-size: 14px;
              font-weight: 500;
              z-index: 10000;
              box-shadow: 0 4px 12px rgba(0,0,0,0.15);
              animation: slideIn 0.3s ease;
            `,o.innerHTML='🔧 Open DevTools (F12) and switch to "IndexedDB Explorer" tab!';const n=document.createElement("style");n.textContent=`
              @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
              }
            `,document.head.appendChild(n),document.body.appendChild(o),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o),n.parentNode&&n.parentNode.removeChild(n)},4e3)}})}),window.close()};r.useEffect(()=>{x()},[]);const u=i.reduce((t,o)=>t+(o.storeCount||0),0),m=l.reduce((t,o)=>t+(o.recordCount||0),0);return e.jsxs("div",{style:{width:"350px",maxHeight:"600px",padding:"0",fontFamily:"system-ui, sans-serif",backgroundColor:"#ffffff",border:"1px solid #e1e5e9",borderRadius:"8px",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"16px 20px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"8px"},children:[e.jsx("span",{style:{fontSize:"24px",marginRight:"8px"},children:"🗄️"}),e.jsx("h2",{style:{margin:0,fontSize:"18px",fontWeight:"600"},children:"IndexedDB Explorer"})]}),e.jsx("p",{style:{margin:0,fontSize:"13px",opacity:.9},children:"Browse and manage IndexedDB databases"})]}),e.jsx("div",{style:{padding:"16px 20px",backgroundColor:"#f8f9fa",borderBottom:"1px solid #e9ecef"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"20px",fontWeight:"700",color:"#495057"},children:i.length}),e.jsxs("div",{style:{fontSize:"12px",color:"#6c757d"},children:["Database",i.length!==1?"s":""]})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"20px",fontWeight:"700",color:"#495057"},children:u}),e.jsxs("div",{style:{fontSize:"12px",color:"#6c757d"},children:["Table",u!==1?"s":""]})]}),s&&l.length>0&&e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"20px",fontWeight:"700",color:"#495057"},children:m.toLocaleString()}),e.jsxs("div",{style:{fontSize:"12px",color:"#6c757d"},children:["Record",m!==1?"s":""]})]})]})}),h&&e.jsxs("div",{style:{padding:"12px 20px",backgroundColor:"#f8d7da",color:"#721c24",fontSize:"12px",borderBottom:"1px solid #f5c6cb"},children:["⚠️ ",h]}),e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto",padding:"16px 20px"},children:d?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",padding:"40px 0",color:"#6c757d"},children:e.jsx("div",{children:"🔄 Loading databases..."})}):i.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:"#6c757d"},children:[e.jsx("div",{style:{fontSize:"32px",marginBottom:"12px"},children:"📭"}),e.jsx("p",{style:{margin:"0 0 8px 0",fontSize:"14px",fontWeight:"500"},children:"No IndexedDB databases found"}),e.jsx("p",{style:{margin:0,fontSize:"12px"},children:"This page doesn't use IndexedDB or databases are not accessible."}),e.jsx("button",{onClick:x,style:{marginTop:"12px",padding:"6px 12px",fontSize:"12px",border:"1px solid #007bff",borderRadius:"4px",backgroundColor:"#007bff",color:"white",cursor:"pointer"},children:"🔄 Try Again"})]}):e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsx("h3",{style:{margin:0,fontSize:"14px",fontWeight:"600",color:"#495057"},children:"Databases"}),e.jsx("button",{onClick:x,disabled:d,style:{padding:"4px 8px",fontSize:"11px",border:"1px solid #dee2e6",borderRadius:"4px",cursor:d?"not-allowed":"pointer",backgroundColor:d?"#f8f9fa":"white",color:"#6c757d"},children:d?"🔄":"🔄 Refresh"})]}),i.map(t=>e.jsxs("div",{style:{marginBottom:"8px",border:"1px solid #e9ecef",borderRadius:"6px",overflow:"hidden"},children:[e.jsx("div",{onClick:()=>S(t.name),style:{padding:"12px",cursor:"pointer",backgroundColor:s===t.name?"#e3f2fd":"white",borderBottom:s===t.name?"1px solid #e9ecef":"none",transition:"background-color 0.2s"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"#343a40"},children:t.name}),e.jsxs("div",{style:{fontSize:"12px",color:"#6c757d"},children:["v",t.version," • ",t.storeCount," table",t.storeCount!==1?"s":""]})]}),e.jsx("span",{style:{fontSize:"12px",color:"#6c757d",transform:s===t.name?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s"},children:"▶"})]})}),s===t.name&&e.jsx("div",{style:{backgroundColor:"#f8f9fa"},children:l.length>0?l.map(o=>e.jsxs("div",{style:{padding:"8px 16px",fontSize:"12px",borderBottom:"1px solid #e9ecef",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{style:{color:"#495057"},children:["📊 ",o.name]}),e.jsxs("span",{style:{color:"#6c757d"},children:[o.recordCount.toLocaleString()," records"]})]},o.name)):e.jsx("div",{style:{padding:"12px 16px",fontSize:"12px",color:"#6c757d",textAlign:"center"},children:s===t.name?"Loading tables...":"Click to expand"})})]},t.name))]})}),e.jsxs("div",{style:{padding:"16px 20px",backgroundColor:"#f8f9fa",borderTop:"1px solid #e9ecef"},children:[e.jsx("button",{onClick:w,style:{width:"100%",padding:"10px",fontSize:"14px",fontWeight:"500",border:"none",borderRadius:"6px",cursor:"pointer",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",marginBottom:"8px"},children:"🔧 Open Advanced Panel"}),e.jsx("div",{style:{fontSize:"11px",color:"#6c757d",textAlign:"center"},children:'💡 Use F12 → "IndexedDB Explorer" tab for full features'})]}),!1]})},b=document.getElementById("root");b&&C(b).render(e.jsx(z,{}));
